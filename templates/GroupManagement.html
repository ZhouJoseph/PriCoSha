<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PriCoSha | Group Management</title>
    <link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/main.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
        <div class="container">
            <a class="navbar-brand" href="#">PriCoSha</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{url_for('index')}}">home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{url_for('post')}}">post</a>
                    </li>
		            <li class="nav-item">
                        <a class="nav-link active" href="{{url_for('GroupManagement')}}">your groups</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{url_for('logout')}}">logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <center>
    {% if errors %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ errors }}
        <button type="button" class="close" aria-label="Close" onclick="hideAlert()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {% endif %}
    <div id="form-div">
        <h6>Create New Group:</h6>
        <div class="input-group form-group">
            <div class="input-group-prepend">
                <span class="input-group-text" id="">Name</span>
            </div>
            <input type="text" class="form-control" id= "groupname" name="groupname" placeholder="Group Name" autocomplete="off">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="description" name="description" placeholder="Description" autocomplete="off">
        </div>
        <button onclick="createGroup()" class="btn btn-primary" style="width:100%">Create</button>
        </form>
    </div>
    <br>
    Your Groups:<br>
    <ul class="list-group" style="width:50%;min-width: 300px" id="groups"></ul>
    </center>

    <!-- If you groups/fetch, you can get rid of this,
    and do all the stuff in ajax call(in a function!)
    That's more doable because after we create a group
    We still need to update the UI.
    However, doing the following cannot allow us to instant update -->

<!-- #Create FG, Give it a Unique name, Might add description
#Might add User to FG, no duplication allowed -->

    <script src="{{url_for('static', filename='vendor/jquery/jquery.min.js')}}"></script>
    <script src="{{url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js')}}"></script>
    <script src="{{url_for('static',filename='vendor/bootstrap/js/bootstrap-filestyle.min.js')}}"> </script>

    <script>

        function createGroup(){
            var groupname = $('#groupname').val();
            var description = $('#description').val();
            $.ajax({
                type: "POST",
                url: "/groups/create",
                data: {
                    "groupname": groupname,
                    "description": description,
                },
                success: function(info){
                    if(info.fg_name && info.owner){
                        updateGroupUI(info.fg_name,info.description,info.owner);
                    }else{
                        alert('You cannot own two groups with the same name')
                    }
                },
                error: function(err){
                    alert("err");
                }
            });
        }

    function generateSpan(fg_name,description,owner){
        var span = '<span class="list-group-item list-group-item-action disabled">' + fg_name + '; description: '
         + description + '; owner: ' + owner +
         '<a href="#friendAdd" role="button" class="btn btn-outline-dark mb-2" data-toggle="modal">Add / De friend</a>' +
         '</span>';
        return span;
    };

    $.ajax({
        type: "GET",
        url: "/groups/fetch",
        success: function(groups){
            if(groups.data){
                for(var i = 0; i < groups.data.length; i++){
                    updateGroupUI(groups.data[i][0],groups.data[i][1],groups.data[i][2]);
                }
            }
        },
        error: function(err){
            alert("err");
        }
    });
    function updateGroupUI(fg_name,description, owner){
        var span = generateSpan(fg_name,description,owner);
        $("#groups").append(span);
    }
    function hideAlert(){
        $(".alert").hide();
    }
</script>

</body>

</html>
